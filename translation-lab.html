<!--
FILE NAME: translation-lab.html
Open at: https://ineedtolearnkorean.github.io/translation-lab.html
-->

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Korean Fluency Lab â€” Translation</title>

<style>
  body{font-family:Arial;background:#f4f6ff;text-align:center;padding:30px;}
  button{padding:10px 18px;margin:6px;border:none;border-radius:10px;background:#6f82ff;color:white;font-size:15px;cursor:pointer;}
  button.secondary{background:#8a8fa8;}
  .card{background:white;padding:25px;border-radius:18px;width:92%;max-width:980px;margin:auto;margin-top:20px;}
  .wordbank span{background:#eef1ff;padding:8px 12px;margin:6px;border-radius:10px;display:inline-block;}
  input{padding:12px;width:86%;max-width:820px;margin-top:15px;}
  .correct{color:green;} .wrong{color:red;}
  .small{opacity:.85;font-size:13px;line-height:1.4;}
  .row{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px;}
  .pill{background:#f2f2ff;border:1px solid #e2e2ff;border-radius:999px;padding:6px 10px;font-size:13px;}
</style>
</head>

<body>

<h1>ğŸ‡°ğŸ‡· Korean Fluency Lab</h1>

<div class="row">
  <button id="btnTranslation">âœï¸ Translation</button>
  <button id="btnGrammar">ğŸ“˜ Grammar</button>
  <button id="btnConj">âœï¸ Conjugation</button>
  <button id="btnIrregular">ğŸ”¥ Irregulars</button>
</div>

<div id="app" class="card"></div>

<script>
/* ==========================
   UTIL
========================== */
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    const t=a[i]; a[i]=a[j]; a[j]=t;
  }
  return a;
}
function setApp(html){ document.getElementById("app").innerHTML = html; }
function norm(x){ return String(x||"").replace(/\s+/g," ").trim(); }

/* ==========================
   GLOBAL CURRENT STATE
========================== */
let CURRENT_HINT = "";
let CURRENT_ANSWER = "";
let CURRENT_NOTE = "";
let CURRENT_IRREGULAR_TRUTH = null;

/* ==========================
   VOCAB (yours + drama)
========================== */
const vocab = {
  subjects: [
    {en:"I", kr:"ì €ëŠ”"},
    {en:"My friend", kr:"ì¹œêµ¬ëŠ”"},
    {en:"That person", kr:"ê·¸ ì‚¬ëŒì€"},
    {en:"We", kr:"ìš°ë¦¬ëŠ”"}
  ],
  objects: [
    {en:"the Instagram photo", kr:"ì¸ìŠ¤íƒ€ ì‚¬ì§„ì„"},
    {en:"the post", kr:"ê²Œì‹œë¬¼ì„"},
    {en:"the message", kr:"ë©”ì‹œì§€ë¥¼"},
    {en:"Korean", kr:"í•œêµ­ì–´ë¥¼"}
  ],
  verbsBase: [
    {en:"study", krPast:"ê³µë¶€í–ˆì–´ìš”"},
    {en:"delete", krPast:"ì§€ì› ì–´ìš”"},
    {en:"hear", krPast:"ë“¤ì—ˆì–´ìš”"},
    {en:"learn", krPast:"ë°°ì› ì–´ìš”"},
    {en:"send", krPast:"ë³´ëƒˆì–´ìš”"}
  ],
  distractorsKR: [
    "ì˜¤í•´","ì˜ë¯¸","í†µì—­","ë‚ ì§œ","ê²Œì‹œë˜ë‹¤","ë³€í•˜ë‹¤","ë‹¬ë¼ì§€ë‹¤","ì²´ê°","ì˜ì‹ ë¶ˆëª…","ìƒíƒœ"
  ]
};

const connectors = [
  { en:"Even though I was tired,", kr:"í”¼ê³¤í–ˆì§€ë§Œ" },
  { en:"Because I was studying,", kr:"ê³µë¶€í•˜ëŠë¼" },
  { en:"While listening to music,", kr:"ìŒì•…ì„ ë“¤ìœ¼ë©´ì„œ" },
  { en:"After studying,", kr:"ê³µë¶€í•œ í›„ì—" }
];

function verbToGeDoeda(V){
  const map = {
    "study":"ê³µë¶€í•˜ê²Œ ëì–´ìš”",
    "delete":"ì§€ìš°ê²Œ ëì–´ìš”",
    "hear":"ë“£ê²Œ ëì–´ìš”",
    "learn":"ë°°ìš°ê²Œ ëì–´ìš”",
    "send":"ë³´ë‚´ê²Œ ëì–´ìš”"
  };
  return map[V.en] || "í•˜ê²Œ ëì–´ìš”";
}
function verbToUlPpeon(V){
  const map = {
    "study":"ê³µë¶€í•  ë»”í–ˆì–´ìš”",
    "delete":"ì§€ìš¸ ë»”í–ˆì–´ìš”",
    "hear":"ë“¤ì„ ë»”í–ˆì–´ìš”",
    "learn":"ë°°ìš¸ ë»”í–ˆì–´ìš”",
    "send":"ë³´ë‚¼ ë»”í–ˆì–´ìš”"
  };
  return map[V.en] || "í•  ë»”í–ˆì–´ìš”";
}
function verbToSulBakkae(V){
  const map = {
    "study":"ê³µë¶€í•  ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”",
    "delete":"ì§€ìš¸ ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”",
    "hear":"ë“¤ì„ ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”",
    "learn":"ë°°ìš¸ ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”",
    "send":"ë³´ë‚¼ ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”"
  };
  return map[V.en] || "í•  ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”";
}

/* ==========================
   PATTERNS (mostly B2)
========================== */
const patterns = [
  {
    hint:"~ê²Œ ë˜ë‹¤ = ended up / came to",
    build: ({S,O,V}) => ({
      en: `${S.en} ended up ${V.en}ing ${O.en}.`,
      kr: `${S.kr} ${O.kr} ${verbToGeDoeda(V)}`
    })
  },
  {
    hint:"~(ìœ¼)ã„¹ ë»”í–ˆë‹¤ = almost did",
    build: ({S,O,V}) => ({
      en: `${S.en} almost ${V.en}ed ${O.en}.`,
      kr: `${S.kr} ${O.kr} ${verbToUlPpeon(V)}`
    })
  },
  {
    hint:"~(ìœ¼)ã„¹ ìˆ˜ë°–ì— ì—†ë‹¤ = have no choice but to",
    build: ({S,O,V}) => ({
      en: `${S.en} had no choice but to ${V.en} ${O.en}.`,
      kr: `${S.kr} ${O.kr} ${verbToSulBakkae(V)}`
    })
  },
  {
    hint:"~(ìœ¼)ã„¹ í…ë° = would probably / I assume",
    build: () => ({
      en: `That would probably cause a misunderstanding.`,
      kr: `ê·¸ê±´ ì˜¤í•´ê°€ ìƒê¸¸ í…ë°ìš”`
    })
  },
  {
    hint:"~ì•˜/ì—ˆì–´ì•¼ í–ˆë‹¤ = should have done",
    build: () => ({
      en: `I should have listened.`,
      kr: `ë“¤ì—ˆì–´ì•¼ í–ˆì–´ìš”`
    })
  },
  {
    hint:"~(ã„´/ëŠ”)ë‹¤ëŠ” ê²ƒ = the fact thatâ€¦",
    build: () => ({
      en: `I heard that many things changed.`,
      kr: `ë§ì€ ê²Œ ë³€í–ˆë‹¤ëŠ” ê²ƒì„ ë“¤ì—ˆì–´ìš”`
    })
  },
  {
    hint:"~ë‹¬ë¼ê³  í•˜ë‹¤ = ask someone to do something",
    build: () => ({
      en: `I asked the interpreter to delete the photo.`,
      kr: `í†µì—­ì—ê²Œ ì‚¬ì§„ì„ ì§€ì›Œ ë‹¬ë¼ê³  í–ˆì–´ìš”`
    })
  },
  {
    hint:"~ëŠë¼ + ~ìˆ˜ë°–ì— ì—†ë‹¤",
    build: () => ({
      en: `Because I was studying, I had no choice but to stay home.`,
      kr: `ê³µë¶€í•˜ëŠë¼ ì§‘ì— ìˆì„ ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”`
    })
  },
  {
    hint:"~ì§€ë§Œ = even though / but",
    build: () => ({
      en: `Even though I was tired, I studied.`,
      kr: `í”¼ê³¤í–ˆì§€ë§Œ ê³µë¶€í–ˆì–´ìš”`
    })
  },
  {
    hint:"~ëŠ” ê²ƒ ê°™ë‹¤ = it seems / I guess",
    build: () => ({
      en: `It seems like a misunderstanding happened.`,
      kr: `ì˜¤í•´ê°€ ìƒê¸´ ê²ƒ ê°™ì•„ìš”`
    })
  }
];

/* ==========================
   TRANSLATION MODE
========================== */
function renderTranslation(){
  setApp(`
    <h2>Translate to Korean:</h2>
    <p><b id="enSentence"></b></p>

    <div class="row">
      <span class="pill">Type the full sentence</span>
      <span class="pill">Word bank includes distractors</span>
      <span class="pill">Mostly B2</span>
    </div>

    <div class="row" style="margin-top:14px;">
      <button id="btnHint">Show Grammar Hint</button>
      <button class="secondary" id="btnReveal">Reveal Answer</button>
      <button class="secondary" id="btnNew">New Sentence</button>
    </div>

    <h3>Word Bank</h3>
    <div class="wordbank" id="wordbank"></div>

    <input id="userAnswer" placeholder="Type Korean hereâ€¦" />
    <br><br>
    <button id="btnCheck">Check</button>

    <p id="hint" class="small"></p>
    <p id="feedback"></p>
    <p id="solution" class="small"></p>
  `);

  // hook buttons
  document.getElementById("btnHint").onclick = () => {
    document.getElementById("hint").innerHTML = `<b>Hint:</b> ${CURRENT_HINT}`;
  };
  document.getElementById("btnReveal").onclick = () => {
    document.getElementById("solution").innerHTML = `<b>Model answer:</b> ${CURRENT_ANSWER}`;
  };
  document.getElementById("btnNew").onclick = generateExercise;
  document.getElementById("btnCheck").onclick = () => {
    const user = norm(document.getElementById("userAnswer").value);
    const ans = norm(CURRENT_ANSWER);
    const fb = document.getElementById("feedback");
    const sol = document.getElementById("solution");

    if(user === ans){
      fb.innerHTML = `<span class="correct">Perfect!! ğŸ‰</span>`;
      sol.innerHTML = "";
    }else{
      fb.innerHTML = `<span class="wrong">Not quite â€” tweak particles/endings ğŸ’ª</span>`;
      sol.innerHTML = `<b>Model answer:</b> ${CURRENT_ANSWER}`;
    }
  };
}

function generateExercise(){
  const useConnector = Math.random() < 0.7;
  const C = useConnector ? pick(connectors) : null;

  const S = pick(vocab.subjects);
  const O = pick(vocab.objects);
  const V = pick(vocab.verbsBase);
  const P = pick(patterns);

  const built = P.build({S,O,V});
  let en = built.en;
  let kr = built.kr;

  if(C){
    const safeToPrepend =
      !kr.startsWith("ê·¸ê±´") &&
      !kr.startsWith("ë§ì€") &&
      !kr.startsWith("í†µì—­") &&
      !kr.startsWith("ê³µë¶€í•˜ëŠë¼") &&
      !kr.startsWith("í”¼ê³¤í–ˆì§€ë§Œ") &&
      !kr.startsWith("ì˜¤í•´");

    if(safeToPrepend){
      en = `${C.en} ${en}`;
      kr = `${C.kr} ${kr}`;
    }
  }

  CURRENT_HINT = P.hint;
  CURRENT_ANSWER = kr;

  // word bank + distractors
  const baseWords = kr.split(" ").filter(Boolean);
  const distractors = shuffle(vocab.distractorsKR).slice(0, Math.random()<0.5 ? 2 : 1);
  const bank = shuffle(baseWords.concat(distractors));

  // ensure UI exists (first run)
  renderTranslation();

  document.getElementById("enSentence").textContent = en;
  document.getElementById("wordbank").innerHTML = bank.map(w=>`<span>${w}</span>`).join("");
  document.getElementById("hint").innerHTML = "";
  document.getElementById("feedback").innerHTML = "";
  document.getElementById("solution").innerHTML = "";
  document.getElementById("userAnswer").value = "";
}

/* ==========================
   GRAMMAR MODE
========================== */
const grammarLessons = [
  {
    title:"~(ã„´/ëŠ”)ë‹¤ëŠ” ê²ƒ / ~ë‹¤ëŠ” ê²ƒ",
    explain:"Turns a sentence into a noun phrase: â€œthe fact thatâ€¦â€.\n- Verb present: ã„´/ëŠ”ë‹¤ëŠ” ê²ƒ\n- Adj: ë‹¤ëŠ” ê²ƒ\n- Past: ì•˜/ì—ˆë‹¤ëŠ” ê²ƒ",
    examples:["ë§ì€ ê²Œ ë³€í–ˆë‹¤ëŠ” ê²ƒì„ ë“¤ì—ˆì–´ìš”.","ë¹„ê°€ ì˜¨ë‹¤ëŠ” ì†Œì‹ì´ ìˆì–´ìš”."]
  },
  {
    title:"~ë‹¬ë¼ê³  í•˜ë‹¤",
    explain:"Reported request: asked someone to do something.",
    examples:["ì‚¬ì§„ì„ ì§€ì›Œ ë‹¬ë¼ê³  í–ˆì–´ìš”.","ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ ë‹¬ë¼ê³  í–ˆì–´ìš”."]
  },
  {
    title:"~(ìœ¼)ã„¹ í…ë°",
    explain:"Assumption/expectation: would probablyâ€¦",
    examples:["ê·¸ê±´ ì˜¤í•´ê°€ ìƒê¸¸ í…ë°ìš”.","ì§€ê¸ˆ ê°€ë©´ ëŠ¦ì„ í…ë°â€¦"]
  },
  {
    title:"~ëŠë¼",
    explain:"Busy doing X â†’ negative result.",
    examples:["ê³µë¶€í•˜ëŠë¼ ì ì„ ëª» ì¤ì–´ìš”.","ì¼í•˜ëŠë¼ ì—°ë½ì„ ëª» í–ˆì–´ìš”."]
  },
  {
    title:"~(ìœ¼)ã„¹ ìˆ˜ë°–ì— ì—†ë‹¤",
    explain:"No choice but to.",
    examples:["ê¸°ë‹¤ë¦´ ìˆ˜ë°–ì— ì—†ì–´ìš”.","ì˜¤ëŠ˜ì€ ì§‘ì— ìˆì„ ìˆ˜ë°–ì— ì—†ì—ˆì–´ìš”."]
  },
  {
    title:"~(ìœ¼)ã„¹ ë»”í–ˆë‹¤",
    explain:"Almost did (but didnâ€™t).",
    examples:["ê²Œì‹œë¬¼ì„ ì§€ìš¸ ë»”í–ˆì–´ìš”.","ë©”ì‹œì§€ë¥¼ ì˜ëª» ë³´ë‚¼ ë»”í–ˆì–´ìš”."]
  },
  {
    title:"~ì•˜/ì—ˆì–´ì•¼ í–ˆë‹¤",
    explain:"Regret: should have done.",
    examples:["ë” ì¼ì° ê³µë¶€í–ˆì–´ì•¼ í–ˆì–´ìš”.","ë“¤ì—ˆì–´ì•¼ í–ˆì–´ìš”."]
  }
];

function grammarLesson(){
  const L = pick(grammarLessons);
  setApp(`
    <h2>${L.title}</h2>
    <p class="small" style="white-space:pre-line;">${L.explain}</p>
    <h3>Examples</h3>
    ${L.examples.map(e=>`<p><b>${e}</b></p>`).join("")}
    <div class="row" style="margin-top:14px;">
      <button id="backToTrans">Go to Translation</button>
      <button class="secondary" id="anotherLesson">Another Lesson</button>
    </div>
  `);
  document.getElementById("backToTrans").onclick = generateExercise;
  document.getElementById("anotherLesson").onclick = grammarLesson;
}

/* ==========================
   CONJUGATION MODE (B2 targets)
========================== */
const conjPrompts = [
  { label:"polite present (í•´ìš”ì²´)", fn:"present" },
  { label:"polite past (í–ˆì–´ìš”)", fn:"past" },
  { label:"future (í•  ê±°ì˜ˆìš”)", fn:"future" },
  { label:"regret (í–ˆì–´ì•¼ í–ˆì–´ìš”)", fn:"regret" },
  { label:"assumption (í•  í…ë°ìš”)", fn:"assume" },
  { label:"almost (í•  ë»”í–ˆì–´ìš”)", fn:"almost" }
];

const conjMap = {
  // present
  "ë“£ë‹¤": {present:"ë“¤ì–´ìš”", past:"ë“¤ì—ˆì–´ìš”", future:"ë“¤ì„ ê±°ì˜ˆìš”", regret:"ë“¤ì—ˆì–´ì•¼ í–ˆì–´ìš”", assume:"ë“¤ì„ í…ë°ìš”", almost:"ë“¤ì„ ë»”í–ˆì–´ìš”"},
  "ê±·ë‹¤": {present:"ê±¸ì–´ìš”", past:"ê±¸ì—ˆì–´ìš”", future:"ê±¸ì„ ê±°ì˜ˆìš”", regret:"ê±¸ì—ˆì–´ì•¼ í–ˆì–´ìš”", assume:"ê±¸ì„ í…ë°ìš”", almost:"ê±¸ì„ ë»”í–ˆì–´ìš”"},
  "ë•ë‹¤": {present:"ë„ì™€ìš”", past:"ë„ì™”ì–´ìš”", future:"ë„ìš¸ ê±°ì˜ˆìš”", regret:"ë„ì™”ì–´ì•¼ í–ˆì–´ìš”", assume:"ë„ìš¸ í…ë°ìš”", almost:"ë„ìš¸ ë»”í–ˆì–´ìš”"},
  "ì–´ë µë‹¤": {present:"ì–´ë ¤ì›Œìš”", past:"ì–´ë ¤ì› ì–´ìš”", future:"ì–´ë ¤ìš¸ ê±°ì˜ˆìš”", regret:"ì–´ë ¤ì› ì–´ì•¼ í–ˆì–´ìš”", assume:"ì–´ë ¤ìš¸ í…ë°ìš”", almost:"ì–´ë ¤ìš¸ ë»”í–ˆì–´ìš”"},
  "ëª¨ë¥´ë‹¤": {present:"ëª°ë¼ìš”", past:"ëª°ëì–´ìš”", future:"ëª¨ë¥¼ ê±°ì˜ˆìš”", regret:"ëª°ëì–´ì•¼ í–ˆì–´ìš”", assume:"ëª¨ë¥¼ í…ë°ìš”", almost:"ëª¨ë¥¼ ë»”í–ˆì–´ìš”"},
  "ë‹¤ë¥´ë‹¤": {present:"ë‹¬ë¼ìš”", past:"ë‹¬ëì–´ìš”", future:"ë‹¤ë¥¼ ê±°ì˜ˆìš”", regret:"ë‹¬ëì–´ì•¼ í–ˆì–´ìš”", assume:"ë‹¤ë¥¼ í…ë°ìš”", almost:"ë‹¤ë¥¼ ë»”í–ˆì–´ìš”"},
  "ì“°ë‹¤": {present:"ì¨ìš”", past:"ì¼ì–´ìš”", future:"ì“¸ ê±°ì˜ˆìš”", regret:"ì¼ì–´ì•¼ í–ˆì–´ìš”", assume:"ì“¸ í…ë°ìš”", almost:"ì“¸ ë»”í–ˆì–´ìš”"},
  "ë°”ì˜ë‹¤": {present:"ë°”ë¹ ìš”", past:"ë°”ë¹´ì–´ìš”", future:"ë°”ì  ê±°ì˜ˆìš”", regret:"ë°”ë¹´ì–´ì•¼ í–ˆì–´ìš”", assume:"ë°”ì  í…ë°ìš”", almost:"ë°”ì  ë»”í–ˆì–´ìš”"},
  "ë§Œë“¤ë‹¤": {present:"ë§Œë“¤ì–´ìš”", past:"ë§Œë“¤ì—ˆì–´ìš”", future:"ë§Œë“¤ ê±°ì˜ˆìš”", regret:"ë§Œë“¤ì—ˆì–´ì•¼ í–ˆì–´ìš”", assume:"ë§Œë“¤ í…ë°ìš”", almost:"ë§Œë“¤ ë»”í–ˆì–´ìš”"},
  "ì‚´ë‹¤": {present:"ì‚´ì•„ìš”", past:"ì‚´ì•˜ì–´ìš”", future:"ì‚´ ê±°ì˜ˆìš”", regret:"ì‚´ì•˜ì–´ì•¼ í–ˆì–´ìš”", assume:"ì‚´ í…ë°ìš”", almost:"ì‚´ ë»”í–ˆì–´ìš”"},
  "ê·¸ë ‡ë‹¤": {present:"ê·¸ë˜ìš”", past:"ê·¸ë¬ì–´ìš”", future:"ê·¸ëŸ´ ê±°ì˜ˆìš”", regret:"ê·¸ë¬ì–´ì•¼ í–ˆì–´ìš”", assume:"ê·¸ëŸ´ í…ë°ìš”", almost:"ê·¸ëŸ´ ë»”í–ˆì–´ìš”"},
  "íŒŒë—ë‹¤": {present:"íŒŒë˜ìš”", past:"íŒŒë¬ì–´ìš”", future:"íŒŒë„ ê±°ì˜ˆìš”", regret:"íŒŒë¬ì–´ì•¼ í–ˆì–´ìš”", assume:"íŒŒë„ í…ë°ìš”", almost:"íŒŒë„ ë»”í–ˆì–´ìš”"}
};

const conjVerbs = Object.keys(conjMap);

function conjugation(){
  const v = pick(conjVerbs);
  const t = pick(conjPrompts);
  CURRENT_ANSWER = conjMap[v][t.fn];

  setApp(`
    <h2>Conjugation Practice (B2)</h2>
    <p><b>Verb:</b> ${v}</p>
    <p><b>Target:</b> ${t.label}</p>

    <input id="userAnswer" placeholder="Type the conjugated formâ€¦" />
    <br><br>
    <button id="btnCheck">Check</button>
    <button class="secondary" id="btnReveal">Reveal</button>

    <p id="feedback"></p>
    <p id="solution" class="small"></p>

    <div class="row" style="margin-top:14px;">
      <button id="btnNext">Next</button>
      <button class="secondary" id="btnBack">Back to Translation</button>
    </div>
  `);

  document.getElementById("btnCheck").onclick = () => {
    const user = norm(document.getElementById("userAnswer").value);
    const ans = norm(CURRENT_ANSWER);
    const fb = document.getElementById("feedback");
    const sol = document.getElementById("solution");

    if(user === ans){
      fb.innerHTML = `<span class="correct">Correct ğŸ”¥</span>`;
      sol.innerHTML = "";
    }else{
      fb.innerHTML = `<span class="wrong">Not yet â€” check the irregular + ending ğŸ’ª</span>`;
      sol.innerHTML = `<b>Model:</b> ${CURRENT_ANSWER}`;
    }
  };

  document.getElementById("btnReveal").onclick = () => {
    document.getElementById("solution").innerHTML = `<b>Model:</b> ${CURRENT_ANSWER}`;
  };
  document.getElementById("btnNext").onclick = conjugation;
  document.getElementById("btnBack").onclick = generateExercise;
}

/* ==========================
   IRREGULAR MODE (trap + target)
========================== */
const irregularQuiz = [
  {base:"ë“£ë‹¤", irregular:true, note:"ã„·â†’ã„¹ before vowel"},
  {base:"ê±·ë‹¤", irregular:true, note:"ã„·â†’ã„¹ before vowel"},
  {base:"ë¬»ë‹¤(ask)", irregular:true, note:"ë¬»ë‹¤(ask) is ã„· irregular"},
  {base:"ë‹«ë‹¤", irregular:false, note:"ë‹«ë‹¤ is regular (trap)"},
  {base:"ë°›ë‹¤", irregular:false, note:"ë°›ë‹¤ is regular (trap)"},
  {base:"ë•ë‹¤", irregular:true, note:"ã…‚â†’ì˜¤/ìš°"},
  {base:"ì–´ë µë‹¤", irregular:true, note:"ã…‚â†’ì˜¤/ìš°"},
  {base:"ì¡ë‹¤", irregular:false, note:"ì¡ë‹¤ is regular (trap)"},
  {base:"ì…ë‹¤", irregular:false, note:"ì…ë‹¤ is regular (trap)"},
  {base:"ëª¨ë¥´ë‹¤", irregular:true, note:"ë¥´â†’ã„¹ã„¹ + ì•„/ì–´"},
  {base:"ë‹¤ë¥´ë‹¤", irregular:true, note:"ë¥´â†’ã„¹ã„¹ + ì•„/ì–´"},
  {base:"ì“°ë‹¤", irregular:true, note:"ã…¡ drop"},
  {base:"ë°”ì˜ë‹¤", irregular:true, note:"ã…¡ drop"},
  {base:"ë§Œë“¤ë‹¤", irregular:true, note:"ã„¹ drops before ã„´/ã…‚/ã……"},
  {base:"ì‚´ë‹¤", irregular:true, note:"ã„¹ drops before ã„´/ã…‚/ã……"},
  {base:"ê·¸ë ‡ë‹¤", irregular:true, note:"ã… irregular"},
  {base:"íŒŒë—ë‹¤", irregular:true, note:"ã… irregular"}
];

const targetFns = [
  {label:"polite present", fn:"present"},
  {label:"polite past", fn:"past"},
  {label:"future", fn:"future"},
  {label:"assumption (í…ë°ìš”)", fn:"assume"},
  {label:"regret (ì–´ì•¼ í–ˆë‹¤)", fn:"regret"},
  {label:"almost (ë»”í–ˆë‹¤)", fn:"almost"}
];

const regularExtras = {
  "ë¬»ë‹¤": {present:"ë¬¼ì–´ìš”", past:"ë¬¼ì—ˆì–´ìš”", future:"ë¬¼ì„ ê±°ì˜ˆìš”", assume:"ë¬¼ì„ í…ë°ìš”", regret:"ë¬¼ì—ˆì–´ì•¼ í–ˆì–´ìš”", almost:"ë¬¼ì„ ë»”í–ˆì–´ìš”"},
  "ë‹«ë‹¤": {present:"ë‹«ì•„ìš”", past:"ë‹«ì•˜ì–´ìš”", future:"ë‹«ì„ ê±°ì˜ˆìš”", assume:"ë‹«ì„ í…ë°ìš”", regret:"ë‹«ì•˜ì–´ì•¼ í–ˆì–´ìš”", almost:"ë‹«ì„ ë»”í–ˆì–´ìš”"},
  "ë°›ë‹¤": {present:"ë°›ì•„ìš”", past:"ë°›ì•˜ì–´ìš”", future:"ë°›ì„ ê±°ì˜ˆìš”", assume:"ë°›ì„ í…ë°ìš”", regret:"ë°›ì•˜ì–´ì•¼ í–ˆì–´ìš”", almost:"ë°›ì„ ë»”í–ˆì–´ìš”"},
  "ì¡ë‹¤": {present:"ì¡ì•„ìš”", past:"ì¡ì•˜ì–´ìš”", future:"ì¡ì„ ê±°ì˜ˆìš”", assume:"ì¡ì„ í…ë°ìš”", regret:"ì¡ì•˜ì–´ì•¼ í–ˆì–´ìš”", almost:"ì¡ì„ ë»”í–ˆì–´ìš”"},
  "ì…ë‹¤": {present:"ì…ì–´ìš”", past:"ì…ì—ˆì–´ìš”", future:"ì…ì„ ê±°ì˜ˆìš”", assume:"ì…ì„ í…ë°ìš”", regret:"ì…ì—ˆì–´ì•¼ í–ˆì–´ìš”", almost:"ì…ì„ ë»”í–ˆì–´ìš”"}
};

function irregular(){
  const Q = pick(irregularQuiz);
  const T = pick(targetFns);

  CURRENT_NOTE = Q.note;
  CURRENT_IRREGULAR_TRUTH = Q.irregular;

  let base = Q.base;
  if(base.indexOf("(") !== -1) base = base.split("(")[0]; // ë¬»ë‹¤(ask) -> ë¬»ë‹¤

  if(conjMap[base]){
    CURRENT_ANSWER = conjMap[base][T.fn];
  }else if(regularExtras[base]){
    CURRENT_ANSWER = regularExtras[base][T.fn];
  }else{
    CURRENT_ANSWER = "(not configured)";
  }

  setApp(`
    <h2>Irregulars (B2)</h2>
    <p><b>Verb:</b> ${Q.base}</p>

    <h3>Step 1) Is it irregular?</h3>
    <div class="row">
      <button id="btnIr">Irregular</button>
      <button id="btnReg">Regular</button>
    </div>
    <p id="irFeedback" class="small"></p>

    <h3 style="margin-top:18px;">Step 2) Conjugate</h3>
    <p><b>Target:</b> ${T.label}</p>

    <input id="userAnswer" placeholder="Type the conjugated formâ€¦" />
    <br><br>
    <button id="btnCheck">Check</button>
    <button class="secondary" id="btnReveal">Reveal</button>

    <p id="feedback"></p>
    <p id="solution" class="small"></p>

    <div class="row" style="margin-top:14px;">
      <button id="btnNext">Next</button>
      <button class="secondary" id="btnBack">Back to Translation</button>
    </div>
  `);

  document.getElementById("btnIr").onclick = () => pickIr(true);
  document.getElementById("btnReg").onclick = () => pickIr(false);

  document.getElementById("btnCheck").onclick = () => {
    const user = norm(document.getElementById("userAnswer").value);
    const ans = norm(CURRENT_ANSWER);
    const fb = document.getElementById("feedback");
    const sol = document.getElementById("solution");
    if(user === ans){
      fb.innerHTML = `<span class="correct">Correct ğŸ”¥</span>`;
      sol.innerHTML = "";
    }else{
      fb.innerHTML = `<span class="wrong">Not yet ğŸ’ª</span>`;
      sol.innerHTML = `<b>Model:</b> ${CURRENT_ANSWER}`;
    }
  };
  document.getElementById("btnReveal").onclick = () => {
    document.getElementById("solution").innerHTML = `<b>Model:</b> ${CURRENT_ANSWER}`;
  };
  document.getElementById("btnNext").onclick = irregular;
  document.getElementById("btnBack").onclick = generateExercise;
}

function pickIr(userSaysIrregular){
  const el = document.getElementById("irFeedback");
  if(!el) return;
  if(Boolean(userSaysIrregular) === Boolean(CURRENT_IRREGULAR_TRUTH)){
    el.innerHTML = `<span class="correct">Correct.</span> <b>Why:</b> ${CURRENT_NOTE}`;
  }else{
    el.innerHTML = `<span class="wrong">Not quite.</span> <b>Note:</b> ${CURRENT_NOTE}`;
  }
}

/* ==========================
   NAV BUTTONS
========================== */
document.getElementById("btnTranslation").onclick = generateExercise;
document.getElementById("btnGrammar").onclick = grammarLesson;
document.getElementById("btnConj").onclick = conjugation;
document.getElementById("btnIrregular").onclick = irregular;

// Default
generateExercise();
</script>

</body>
</html>
